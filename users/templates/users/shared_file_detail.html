{% extends 'users/base.html' %}

{% block main %}
  <h1>{{ user_file.name }}</h1>
  <!-- Предоставляем прямую ссылку на файл -->
  <a href="{{ user_file.file.url }}" target="_blank">Открыть файл</a>

  <!-- Если есть сообщение об ошибке, показываем его здесь -->
  {% if error_message %}
    <p style="color: red;">{{ error_message }}</p>
  {% endif %}

  <!-- Форма для подписания документа -->
  <h2>Подписать документ с помощью PFX файла</h2>
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ pfx_form.as_p }}
    <button type="submit">Подписать файл</button>
  </form>

  <!-- Выводим сообщения Django -->
  {% for message in messages %}
    <p style="color: {% if message.tags %}{{ message.tags }}{% else %}blue{% endif %};">{{ message }}</p>
  {% endfor %}

  <!-- Секция для комментариев -->
  <h2>Комментарии</h2>
  <ul>
    {% for comment in comments %}
      <li>
        <strong>{{ comment.user.username }}</strong> ({{ comment.created_at }}):<br>
        {{ comment.text }}
      </li>
    {% empty %}
      <li>Комментариев нет.</li>
    {% endfor %}
  </ul>

  <!-- Форма для добавления нового комментария -->
  <h2>Добавить комментарий</h2>
  <form method="post">
    {% csrf_token %}
    {{ comment_form.as_p }}
    <button type="submit">Добавить комментарий</button>
  </form>
{% endblock %}
