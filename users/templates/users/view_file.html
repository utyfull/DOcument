{% extends 'users/base.html' %}

{% block main %}
  <h1>{{ user_file.name }}</h1>
  <!-- Предоставляем прямую ссылку на файл -->
  <a href="{{ user_file.file.url }}" target="_blank">Открыть файл</a>

  <!-- Если есть сообщение об ошибке, показываем его здесь -->
  {% if error_message %}
    <p style="color: red;">{{ error_message }}</p>
  {% endif %}

  <!-- Форма для подписания документа -->
  <h1>{{ user_file.name }}</h1>
  <p>{{ user_file.content }}</p>

  <h2>Подписать файл</h2>
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ pfx_form.as_p }}
    <button type="submit">Подписать файл</button>
  </form>

  {% if messages %}
    <ul class="messages">
      {% for message in messages %}
        <li>{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
      {% endfor %}
    </ul>
  {% endif %}

  <!-- Выводим сообщения Django -->
  {% for message in messages %}
    <p style="color: {% if message.tags %}{{ message.tags }}{% else %}blue{% endif %};">{{ message }}</p>
  {% endfor %}

  <!-- Блок для отображения комментариев -->
  <h2>Комментарии к файлу</h2>
  <ul>
    {% for comment in comments %}
      <li>
        <strong>{{ comment.user.username }}</strong> ({{ comment.created_at }}):<br>
        {{ comment.text }}
      </li>
    {% empty %}
      <li>Комментариев нет.</li>
    {% endfor %}
  </ul=>

  {% comment %} <a href="{% url 'users:view_own_file' file.pk %}"> Edit </a> {% endcomment %}
{% endblock %}
